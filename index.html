<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="manifest" href="/site.webmanifest">
<title>Titan AI</title>
<style>
  :root{
    --cream:#fbf8ef;
    --grid:#e6e6e6;
    --accent-yellow:#ffcf4d;
    --accent-green:#44cb80;
    --accent-pink:#ff80ab;
    --muted:#9aa4ad;
    --bg:#121212;
    --panel:#0b0d0f;
    --user-bubble:#e5e5e5;
    --assistant-bubble:#a5d6a7;
    --text-dark:#0b1720;
    --text-light:#edf2f7;
    --radius:12px;
    --sidebar-width:260px;
    --action-h:44px;
  }

  html,body{height:100%;margin:0}
  body{
    font-family:"Inter","Segoe UI",Arial,sans-serif;
    background:var(--bg);
    color:var(--text-light);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  body::before{
    content:"";
    position:fixed;
    inset:0;
    pointer-events:none;
    background-image:
      linear-gradient(to right,var(--grid) 1px,transparent 1px),
      linear-gradient(to bottom,var(--grid) 1px,transparent 1px);
    background-size:48px 48px;
    opacity:0.06;
  }

  .app{display:flex;height:100vh;gap:16px;padding:18px;box-sizing:border-box;}

  .sidebar {
    width: var(--sidebar-width);
    min-width: var(--sidebar-width);
    max-width: var(--sidebar-width);
    background: #222425;
    border-radius: 14px;
    padding: 14px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    box-shadow: 0 8px 30px rgba(0,0,0,0.45);
    box-sizing: border-box;
  }

  .brand h1{margin:0;font-size:1.25rem;color:#ddd}
  .brand p{margin:6px 0 12px;color:#9aa4ad;font-size:0.9rem}

  .new-chat{
    width:100%;
    height:var(--action-h);
    background:var(--accent-yellow);
    border:none;
    border-radius:10px;
    font-weight:700;
    cursor:pointer;
    color:#06131a;
    margin-bottom:12px;
  }

  .saved-list{
    flex:1;
    overflow:auto;
  }

  .chat-item{
    padding:10px;
    border-radius:10px;
    background:var(--user-bubble);
    margin-bottom:8px;
    cursor:pointer;
    font-size:0.95rem;
    color:#071212;
    width: 232px;
    height: 44px;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
    overflow: visible;
    transition: background 0.15s ease;
  }

  .chat-item .chat-title{
    min-width: 0;
    flex: 1 1 auto;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: block;
    color: inherit;
  }

  .chat-item:hover{background:rgba(240, 238, 238, 0.762)}

  .clear-saved{
    width:100%;
    height: 44px;
    border:none;
    border-radius:10px;
    background:#d9534f;
    color:#fff;
    font-weight:700;
    cursor:pointer;
    margin-top:12px;
    box-sizing: border-box;
  }

  /* scrollbar */
  ::-webkit-scrollbar {width: 10px;}
  ::-webkit-scrollbar-track {background: #1e1e1e; border-radius: 10px;}
  ::-webkit-scrollbar-thumb {background-color: #555; border-radius: 10px; border: 2px solid #1e1e1e;}
  ::-webkit-scrollbar-thumb:hover {background-color: #777;}
  * {scrollbar-width: thin; scrollbar-color: #555 #1e1e1e;}

  .panel{
    flex:1;
    display:flex;
    flex-direction:column;
    min-width:0;
  }

  .panel-inner{
    background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.02));
    border-radius:14px;
    padding:14px;
    display:flex;
    flex-direction:column;
    height:100%;
    box-sizing:border-box;
    box-shadow:0 8px 30px rgba(0,0,0,0.35);
  }

  .panel-top{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding-bottom:8px;
    border-bottom:1px solid rgba(255,255,255,0.02);
  }

  .panel-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 12px 4px;
    overflow: auto;
    align-items: stretch;
    justify-content: flex-start;
    height: 100%;
    width: 100%;
    margin-top: 0;
  }

  .messages{
    display:flex;
    flex-direction:column;
    gap:12px;
    align-items:flex-start;
    justify-content:flex-start;
    width:100%;
  }

  .welcome{
    margin:auto;
    text-align:center;
    color:#bfc9cf;
    max-width:720px;
    line-height:1.4;
  }

  .welcome h3{margin:0 0 8px;color:#e6eef6}
  .welcome p{margin:0;color:#9aa4ad;font-size:0.9rem}

  .msg{
    display:inline-block;
    padding:10px 14px;
    border-radius:14px;
    max-width:80%;
    word-wrap:break-word;
    line-height:1.4;
  }

  .msg.bot{
    background:var(--assistant-bubble);
    color:#071212;
    align-self:flex-start;
    border-bottom-left-radius:4px;
  }

  .msg.user{
    background:var(--user-bubble);
    color:#071212;
    align-self:flex-end;
    border-bottom-right-radius:4px;
  }

  .thinking-bubble{
    display:none;
    padding:8px 12px;
    border-radius:12px;
    background:var(--assistant-bubble);
    color:#071212;
    font-style:italic;
    align-self:flex-start;
  }

  .thinking-bubble.visible{display:inline-block}

  .input-row{
    display:flex;
    align-items:center;
    gap:10px;
    padding-top:8px;
    border-top:1px solid rgba(255,255,255,0.02);
  }

  .input-field{
    flex:1;
    padding:12px;
    border-radius:10px;
    border:none;
    background:#fff;
    color:#000;
    outline:none;
    font-size:15px;
    height: 44px;
    box-sizing: border-box;
  }

  .action-btn{
    height:var(--action-h);
    min-width:88px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:700;
    padding:0 14px;
  }

  .send-btn{background:var(--accent-pink);color:#071212}
  .save-btn{background:var(--accent-green);color:#071212}

  .mobile-toggle{display:none}

  @media (max-width:900px){
    .sidebar{
      position:fixed;
      left:0;top:0;bottom:0;
      z-index:40;
      transform:translateX(-110%);
      transition:transform .28s ease;
    }
    .sidebar.open{transform:translateX(0)}
    .mobile-toggle{
      display:flex;
      background:var(--accent-yellow);
      color:#071212;
      border:none;
      border-radius:8px;
      padding:8px;
      cursor:pointer;
      position:absolute;
      right:18px;
      top:18px;
      z-index:50;
      width: 30px;
      height: 30px;
      justify-content: center;
        align-items: center;
    }
  }

  @media (max-width: 425px) {

  /* App container */
  .app {
    padding: 10px;
    gap: 10px;
  }

  /* Sidebar full-screen slide in */
  .sidebar {
    width: 85vw;
    min-width: 85vw;
    max-width: 85vw;
    padding: 12px;
  }

  /* Saved chat items */
  .chat-item {
    width: 100%;
    font-size: 0.85rem;
    height: auto;
    padding: 8px;
  }

  .brand h1 {
    font-size: 1.05rem;
  }

  /* Panel layout */
  .panel-inner {
    padding: 10px;
  }

  .panel-top h2 {
    font-size: 1.1rem;
  }

  .panel-top .subtitle {
    font-size: 0.75rem;
  }

  /* Message area */
  .panel-body {
    gap: 10px;
    padding: 10px 2px;
  }

  .msg {
    max-width: 90%;
    font-size: 0.9rem;
    padding: 8px 10px;
  }

  /* Input row spacing fix */
  .input-row {
    gap: 6px;
    padding-top: 6px;
    flex-wrap: nowrap;
  }

  .input-field {
    height: 40px;
    font-size: 14px;
    padding: 10px;
  }

  .action-btn {
    height: 40px;
    min-width: 70px;
    padding: 0 10px;
    font-size: 0.8rem;
  }

  /* Mobile toggle button (hamburger) */
  .mobile-toggle {
    top: 12px;
    right: 12px;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    font-size: 1rem;
  }
}

@media (max-width: 325px) {

  /* Shrink buttons */
  .action-btn {
    min-width: 40px;
    width: 40px;
    padding: 0;
    font-size: 0; /* hides text */
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* SEND BUTTON → paper plane icon */
  .send-btn::before {
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    content: "\f1d8"; /* fa-paper-plane */
    font-size: 18px;
    color: #071212;
  }

  /* SAVE BUTTON → floppy disk icon */
  .save-btn::before {
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    content: "\f0c7"; /* fa-floppy-disk */
    font-size: 18px;
    color: #071212;
  }

  /* Input spacing */
  .input-row {
    gap: 4px;
  }

  .input-field {
    padding: 8px;
    font-size: 14px;
  }
}

</style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" id="sidebar">
      <div>
        <div class="brand">
          <h1>Titan AI</h1>
          <p>Cloud Security Assistant</p>
        </div>
        <button class="new-chat" id="newChatBtn">New Chat</button>
        <div class="saved-list" id="savedList"></div>
      </div>
      <button class="clear-saved" id="clearSavedBtn">Clear Saved Chats</button>
    </aside>

    <main class="panel">
      <button class="mobile-toggle" id="mobileToggle">☰</button>

      <div class="panel-inner">
        <div class="panel-top">
          <div>
            <h2>Titan AI</h2>
            <div class="subtitle">Cloud Security Assistant</div>
          </div>
        </div>

        <div class="panel-body">
          <div id="messages" class="messages">
            <div id="welcome" class="welcome">
              <h3>Here for your cloud security questions ☁️</h3>
              <p>This tool is for educational purposes only. Always verify with official cloud documentation — we are not responsible for any decisions made based on these responses.</p>
            </div>
          </div>
          <div id="thinkingBubble" class="thinking-bubble">Thinking<span style="margin-left:8px">...</span></div>
        </div>

        <div class="input-row">
          <input id="inputBox" class="input-field" placeholder="Ask a question about cloud security..." />
          <button id="sendBtn" class="action-btn send-btn">Send</button>
          <button id="saveBtn" class="action-btn save-btn">Save Chat</button>
        </div>
      </div>
    </main>
  </div>

<script>
  const sidebar = document.getElementById('sidebar');
  const mobileToggle = document.getElementById('mobileToggle');
  const savedListEl = document.getElementById('savedList');
  const clearSavedBtn = document.getElementById('clearSavedBtn');
  const newChatBtn = document.getElementById('newChatBtn');
  const messagesEl = document.getElementById('messages');
  const welcomeEl = document.getElementById('welcome');
  const thinkingBubble = document.getElementById('thinkingBubble');
  const inputBox = document.getElementById('inputBox');
  const sendBtn = document.getElementById('sendBtn');
  const saveBtn = document.getElementById('saveBtn');

  const STORAGE_KEY = 'titan_saved_chats_v1';
  let savedChats = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  let currentMessages = [];
  let currentChatIndex = null;

  const API_URL = 'https://srtnchyruh.execute-api.eu-west-2.amazonaws.com/prodv2/query?question=';

  function renderSavedList() {
  savedListEl.innerHTML = '';
  savedChats.forEach((chat, idx) => {
    const d = document.createElement('div');
    d.className = 'chat-item';

    const titleSpan = document.createElement('span');
    titleSpan.className = 'chat-title';
    titleSpan.textContent = chat.name || `Chat ${idx + 1}`;

    const deleteBtn = document.createElement('span');
    deleteBtn.textContent = '✖';
    deleteBtn.style.marginLeft = 'auto';
    deleteBtn.style.color = '#444';
    deleteBtn.style.fontWeight = 'bold';
    deleteBtn.style.cursor = 'pointer';
    deleteBtn.title = 'Delete this chat';
    deleteBtn.addEventListener('click', (e) => {
      e.stopPropagation(); // prevent loading the chat when deleting
      deleteChat(idx);
    });

    d.appendChild(titleSpan);
    d.appendChild(deleteBtn);

    d.addEventListener('click', () => {
      autoSaveCurrentChat();
      loadSavedChat(idx);
    });

    savedListEl.appendChild(d);
  });
}


  function loadSavedChat(index) {
    const chat = savedChats[index];
    if (!chat) return;
    currentMessages = JSON.parse(JSON.stringify(chat.messages || []));
    currentChatIndex = index;
    renderMessages();
    if (window.innerWidth < 900) {
      sidebar.classList.remove('open');
      mobileToggle.textContent = '☰';
    }
  }

  function renderMessages() {
    messagesEl.innerHTML = '';
    if (currentMessages.length === 0) {
      messagesEl.appendChild(welcomeEl);
      messagesEl.style.justifyContent = 'center';
      return;
    }
    currentMessages.forEach(m => {
      const div = document.createElement('div');
      div.className = 'msg ' + (m.role === 'user' ? 'user' : 'bot');
      div.textContent = m.text;
      messagesEl.appendChild(div);
    });
    if (messagesEl.contains(welcomeEl)) messagesEl.removeChild(welcomeEl);
    messagesEl.style.justifyContent = 'flex-start';
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function appendMessage(role, text) {
    if (messagesEl.contains(welcomeEl)) messagesEl.removeChild(welcomeEl);
    const div = document.createElement('div');
    div.className = 'msg ' + (role === 'user' ? 'user' : 'bot');
    div.textContent = text;
    messagesEl.appendChild(div);
    currentMessages.push({ role, text });
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function showThinking(on) {
    thinkingBubble.classList.toggle('visible', on);
  }

  async function sendQuestion() {
    const q = inputBox.value.trim();
    if (!q) return;
    inputBox.value = '';
    appendMessage('user', q);
    showThinking(true);
    try {
      const res = await fetch(API_URL + encodeURIComponent(q));
      const data = await res.json();
      const answer = data.answer || 'No response from the model.';
      showThinking(false);
      appendMessage('bot', answer);
    } catch (err) {
      showThinking(false);
      appendMessage('bot', 'Error: ' + (err.message || 'network error'));
    }
  }

  // --- AUTO SAVE + MANUAL SAVE LOGIC ---
  function autoSaveCurrentChat() {
    if (currentMessages.length === 0) return;

    const firstUser = currentMessages.find(m => m.role === 'user');
    const nameBase = firstUser ? firstUser.text.slice(0, 40) : 'Untitled Chat';
    const name = (nameBase.length > 40 ? nameBase.slice(0, 40) + '…' : nameBase);

    if (currentChatIndex !== null) {
      savedChats[currentChatIndex] = {
        name,
        messages: JSON.parse(JSON.stringify(currentMessages))
      };
    } else {
      savedChats.push({
        name,
        messages: JSON.parse(JSON.stringify(currentMessages))
      });
      currentChatIndex = savedChats.length - 1;
    }

    localStorage.setItem(STORAGE_KEY, JSON.stringify(savedChats));
    renderSavedList();
  }

  function saveChat() {
    autoSaveCurrentChat();
    currentMessages = [];
    currentChatIndex = null;
    renderMessages();
  }

  function newChat() {
    autoSaveCurrentChat();
    currentMessages = [];
    currentChatIndex = null;
    renderMessages();

    // Close sidebar on mobile view
    if (window.innerWidth < 900) {
      sidebar.classList.remove('open');
      mobileToggle.textContent = '☰';
    }
  }

  function clearSavedChats() {
    savedChats = [];
    localStorage.removeItem(STORAGE_KEY);
    renderSavedList();
    currentChatIndex = null;
  }

  function deleteChat(index) {
  if (index < 0 || index >= savedChats.length) return;
  savedChats.splice(index, 1);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(savedChats));

  // Reset current chat if you deleted the one you were viewing
  if (currentChatIndex === index) {
    currentMessages = [];
    currentChatIndex = null;
    renderMessages();
  }

  renderSavedList();
}


  // --- MOBILE TOGGLE LOGIC ---
  mobileToggle?.addEventListener('click', () => {
    sidebar.classList.toggle('open');
    mobileToggle.textContent = sidebar.classList.contains('open') ? '✖' : '☰';
  });

  sendBtn.addEventListener('click', sendQuestion);
  inputBox.addEventListener('keydown', e => { if (e.key === 'Enter') sendQuestion(); });
  saveBtn.addEventListener('click', saveChat);
  newChatBtn.addEventListener('click', newChat);
  clearSavedBtn.addEventListener('click', clearSavedChats);

  renderSavedList();
  renderMessages();
  inputBox.focus();

  // --- RESPONSIVE PLACEHOLDER LOGIC ---
  function adjustPlaceholder() {
    const w = window.innerWidth;

    if (w < 540) {
      inputBox.placeholder = "Ask a question...";
    } else {
      inputBox.placeholder = "Ask a question about cloud security...";
    }
  }

  window.addEventListener("resize", adjustPlaceholder);
  window.addEventListener("load", adjustPlaceholder);

</script>

</body>
</html>
